<!doctype html>
<html lang="en-GB" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-guides docs-doc-id-gettingStarted/cluster">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Cluster Deployment Instructions | OpenIM Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doc.rentsoft.cn/guides/gettingStarted/cluster"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-guides-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-guides-current"><meta data-rh="true" property="og:title" content="Cluster Deployment Instructions | OpenIM Docs"><meta data-rh="true" name="description" content="Cluster Deployment Instructions"><meta data-rh="true" property="og:description" content="Cluster Deployment Instructions"><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="https://doc.rentsoft.cn/guides/gettingStarted/cluster"><link data-rh="true" rel="alternate" href="https://doc.rentsoft.cn/zh-Hans/guides/gettingStarted/cluster" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://doc.rentsoft.cn/guides/gettingStarted/cluster" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://doc.rentsoft.cn/guides/gettingStarted/cluster" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://NRY7H605ZD-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="OpenIM Docs" href="/opensearch.xml">





<script src="/embed.js"></script><link rel="stylesheet" href="/assets/css/styles.c2eae4fa.css">
<link rel="preload" href="/assets/js/runtime~main.1c292290.js" as="script">
<link rel="preload" href="/assets/js/main.f41c926d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo/light.png" alt="OpenIM Docs" class="themedImage_ToTc themedImage--light_HNdA logo-icon" width="107.5px"><img src="/logo/dark.png" alt="OpenIM Docs" class="themedImage_ToTc themedImage--dark_i4oU logo-icon" width="107.5px"></div></a><a class="navbar__item navbar__link" href="/guides/introduction">Guides</a><a class="navbar__item navbar__link" href="/sdks/introduction">Client SDKs</a><a class="navbar__item navbar__link" href="/restapi/apis/introduction">Server APIs</a><a class="navbar__item navbar__link" href="/blog/introduction">Blog</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"><div class="relative flex items-center gap-2"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search" id="search-bar"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><a href="https://github.com/OpenIMSDK" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link dev-portal-signup dev-portal-link header-github-link">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/zh-Hans/guides/gettingStarted/cluster" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">简体中文</a></li><li><a href="/guides/gettingStarted/cluster" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-GB">English</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_mhZE"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/guides/introduction">OpenIM</a><button aria-label="Toggle the collapsible sidebar category &#x27;OpenIM&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/guides/gettingStarted/imSourceCodeDeployment">快速部署</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/gettingStarted/imSourceCodeDeployment">Source Code Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/gettingStarted/quickTestServer">Quick Verification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/gettingStarted/internalDeployment">内网部署</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/gettingStarted/k8s-deployment">k8s Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/gettingStarted/admin">Monitoring and Alert System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/guides/gettingStarted/cluster">Cluster Deployment Instructions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/gettingStarted/env-comp">Environment and Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/gettingStarted/arm">arm架构部署</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/gettingStarted/config-center">配置中心</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/gettingStarted/faultRecovery">单机生产环境异常处理及数据恢复</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/gettingStarted/faq">常见问题</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/gettingStarted/dockerCompose">Docker Deployment for OpenIM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/gettingStarted/nginxDomainConfig">Nginx Domain Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/guides/pressure_test">Stress Test Report</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/guides/solution/offlinePush">解决方案</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/guides/benchmark_test">Stress and Reliability Test Report</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Cluster Deployment Instructions</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-deployment-instructions">Cluster Deployment Instructions<a href="#cluster-deployment-instructions" class="hash-link" aria-label="Direct link to Cluster Deployment Instructions" title="Direct link to Cluster Deployment Instructions">​</a></h2><p><code>open-im-server</code> supports cluster deployment. Below are the steps for <strong>source cluster</strong> deployment:</p><p><strong>Scenario</strong>: Deploy <code>open-im-server</code> on two machines, Machine A and Machine B, assuming both machines are in the same internal network.</p><p><strong>Machine A</strong>: Deploy <code>open-im-server</code>, <code>nginx</code>, <code>mongo</code>, <code>redis</code>, <code>etcd</code>, <code>kafka</code>, <code>minio</code>, <code>prometheus</code>, <code>grafana</code>, <code>alertmanager</code>.</p><p><strong>Machine B</strong>: Deploy <code>open-im-server</code>.</p><p>The components <code>mongo</code>, <code>redis</code>, <code>kafka</code>, and <code>etcd</code> all support cluster deployment. In the following scenario, each component cluster is deployed on 3 nodes by default.</p><ol><li><p><strong>On Machine A and B</strong>: Clone the repository:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token function" style="color:rgb(220, 220, 170)">git</span><span class="token plain"> clone https://github.com/openimsdk/open-im-server </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">cd</span><span class="token plain"> open-im-server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>On Machine A</strong>: Modify the addresses in <code>kafka</code>, <code>minio</code>, <code>mongodb</code>, <code>etcd</code> (default service discovery method), and <code>redis</code>, configuring them to the correct component addresses. <strong>Ensure that the ports of the connected components are accessible (check if firewall rules allow port access).</strong> Modify the addresses of the corresponding components in the <code>open-im-server/config</code> directory.</p><p>Corresponding configuration file fields:</p><ul><li><code>kafka</code>: <code>kafka.yml:address</code>, containing <code>[ kafkaAddr1, kafkaAddr2, kafkaAddr3 ]</code></li><li><code>minio</code>: <code>minio.yml</code>, <code>internalAddress</code> configures the internal service access address, <code>externalAddress</code> configures the external access address for <code>minio</code>.</li><li><code>mongo</code>: <code>mongodb.yml:address</code>, containing <code>[ mongoAddr1, mongoAddr2, mongoAddr3 ]</code></li><li><code>etcd</code>: <code>discovery.yml:etcd.address</code>, containing <code>[ etcdAddr1, etcdAddr2, etcdAddr3 ]</code></li><li><code>redis</code>: <code>redis.yml:address</code>, containing <code>[ redis1, redis2, redis3 ]</code>, and set <code>clusterMode</code> in <code>redis.yml</code> to <code>true</code> (not needed for single-node deployment).</li></ul></li><li><p>Modify the number of each component as needed in <code>open-im-server/start-config.yml</code>.</p></li><li><p><strong>Deploy <code>nginx</code> on Machine A</strong>, with the following reference configuration:</p><blockquote><p>🚀 <strong>Tip</strong>: Ensure to replace with your actual domain name, SSL certificate path, and SSL key.</p></blockquote><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">events </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    worker_connections 1024;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">http </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">#open-im-server chat Corresponding deployment address and port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    upstream msg_gateway</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">#IM Message server address Multiple can be specified according to the deployment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        server 127.0.0.1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">10001;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        server 192.168.2.36</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">10001;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    upstream im_api</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">#IM Group user api server address Multiple can be specified according to the deployment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        server 127.0.0.1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">10002;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        server 192.168.2.36</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">10001;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    upstream minio_s3_2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">#Minio address can be assigned to multiple modules depending on deployment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        server 127.0.0.1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">10005;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    server </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        listen       443; </span><span class="token comment" style="color:rgb(106, 153, 85)">#Listening on port 443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        server_name  web.xx.xx;  </span><span class="token comment" style="color:rgb(106, 153, 85)">#Your domain name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ssl on;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">#Path of pem file for ssl certificate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ssl_certificate /usr/local/nginx/conf/ssh/web.xx.xx_bundle.pem;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">#Key file path of ssl certificate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        ssl_certificate_key /usr/local/nginx/conf/ssh/web.xx.xx.key;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        gzip on;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        gzip_min_length 1k;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        gzip_buffers 4 16k;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        gzip_comp_level 2;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        gzip_types text/plain application/javascript application/x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">javascript text/css application/xml text/javascript application/x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">httpd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">php image/jpeg image/gif image/png application/wasm;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        gzip_vary off;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        gzip_disable &quot;MSIE </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">6</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">\.&quot;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        location ^~/api/</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_http_version 1.1;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_set_header Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_set_header Connection &quot;Upgrade&quot;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_set_header X</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">real</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ip $remote_addr;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_set_header X</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Forwarded</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">For $remote_addr;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_set_header X</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Request</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Api $scheme</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">//$host/api;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_pass http</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">//im_api/;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        location /msg_gateway</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_http_version 1.1;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_set_header Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_set_header Connection &quot;Upgrade&quot;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_set_header X</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">real</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ip $remote_addr;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_set_header X</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Forwarded</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">For $remote_addr;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_pass http</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">//msg_gateway/;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        location ^~/im</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">minio</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">api/ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_set_header Host $http_host;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_set_header X</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Real</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">IP $remote_addr;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_set_header X</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Forwarded</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_set_header X</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Forwarded</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Proto $scheme;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_connect_timeout 300;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_http_version 1.1;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_set_header Connection &quot;&quot;;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            chunked_transfer_encoding off;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            proxy_pass http</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">//minio_s3_2/;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Compile with <code>mage</code>, start the service with <code>mage start</code>.</p></li><li><p>When initializing the <code>sdk</code>, configure the <code>api</code> connection address as <code>http://web.xx.xx/api</code>, the <code>ws</code> connection address as <code>http://web.xx.xx/msg_gateway</code>, and the <code>minio</code> address as <code>http://web.xx.xx/im-minio-api</code>.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="frequently-asked-questions--notes"><strong>Frequently Asked Questions / Notes</strong><a href="#frequently-asked-questions--notes" class="hash-link" aria-label="Direct link to frequently-asked-questions--notes" title="Direct link to frequently-asked-questions--notes">​</a></h2><ol><li><p>When deploying <code>kafka</code>, you need to modify the broadcast port of <code>kafka</code>. If using <code>docker-compose.yml</code> in <code>open-im-server</code>, modify <code>service.kafka.environment.KAFKA_CFG_ADVERTISED_LISTENERS</code>&#x27;s <code>EXTERNAL</code> to the address to access the <code>kafka</code> component. For other deployment methods, please modify accordingly.
For example: <code>KAFKA_CFG_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092,EXTERNAL://192.168.2.36:19094</code>.</p></li><li><p>Deploying on multiple machines requires ensuring clock synchronization for services to run properly. For example, the issuance of <code>token</code> allows a clock skew within <code>5s</code> across machines.</p></li><li><p>If component ports are inaccessible: Use the loopback address to check if the component has started correctly. If the loopback address is accessible, then check if firewall rules are blocking access.</p></li><li><p>If cluster machines are <strong>not within the internal network</strong>, you need to set <code>autoSetPorts</code> to <code>false</code> and modify the <code>registerIP</code> of each <code>rpc</code> component to the accessible IP address of the server where <code>etcd</code> is deployed, <strong>and ensure that all ports are accessible</strong>. If you need to enable <code>prometheus</code>, you also need to ensure that the <code>prometheus.port</code> of each component is accessible.
Components with <code>autoSetPorts</code> configuration are as follows:</p><ul><li><code>openim-api.yml:prometheus.autoSetPorts</code></li><li><code>openim-msggateway.yml:rpc.autoSetPorts</code></li><li><code>openim-msgtransfer.yml:prometheus.autoSetPorts</code></li><li><code>openim-push.yml:rpc.autoSetPorts</code></li><li><code>openim-rpc-auth.yml:rpc.autoSetPorts</code></li><li><code>openim-rpc-conversation.yml:rpc.autoSetPorts</code></li><li><code>openim-rpc-friend.yml:rpc.autoSetPorts</code></li><li><code>openim-rpc-group.yml:rpc.autoSetPorts</code></li><li><code>openim-rpc-msg.yml:rpc.autoSetPorts</code></li><li><code>openim-rpc-third.yml:rpc.autoSetPorts</code></li><li><code>openim-rpc-user.yml:rpc.autoSetPorts</code></li></ul><p><img loading="lazy" alt="rpc0" src="/assets/images/rpc0-8c5909ddb8b5a525d7610a657865b05c.png" width="1393" height="369" class="img_ev3q"></p><p>Additionally, on Machine A, you need to modify <code>prometheus.yml</code> by removing all <code>http_sd_configs</code> configuration items and their sub-items, adding <code>static_configs</code> configuration items, and changing the <code>targets</code> to the corresponding service ports.
For example: <code>openimserver-openim-api</code> represents the <code>api</code> component&#x27;s <code>prometheus</code> data scraping, so the port address in its <code>target</code> should be consistent with the <code>prometheus.ports</code> in <code>openim-api.yml</code>.</p><p><img loading="lazy" alt="prometheus0" src="/assets/images/prometheus0-c9f806d4aadf70d6e399bc5e2e2be447.png" width="960" height="757" class="img_ev3q"></p></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/OpenIMSDK/docs/tree/main/docs/guides/gettingStarted/cluster.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-09-28T03:28:47.000Z">Sep 28, 2025</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/guides/gettingStarted/admin"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Monitoring and Alert System</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/guides/gettingStarted/env-comp"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Environment and Components</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cluster-deployment-instructions" class="table-of-contents__link toc-highlight">Cluster Deployment Instructions</a></li><li><a href="#frequently-asked-questions--notes" class="table-of-contents__link toc-highlight"><strong>Frequently Asked Questions / Notes</strong></a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container-fluid container"><div class="margin-bottom--sm"><a class="footerLogoLink_DDai" href="/"><img src="/logo/light.png" alt="OpenIM Docs" class="themedImage_ToTc themedImage--light_HNdA footer__logo" height="38px"><img src="/logo/dark.png" alt="OpenIM Docs" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" height="38px"></a></div><p class="footer__description">OpenIM is an open source instant messaging component built by IM technical experts. OpenIM includes IM server and client SDK, which realizes important features such as high performance, light weight, and easy expansion. By integrating OpenIM components and privatizing the deployment of the server, developers can quickly integrate instant messaging and real-time network capabilities into their own applications, and ensure the security and privacy of business data.</p><div class="footer__row"><div class="footer__data"><div class="footer__cta"><p>Join the Slack channel to communicate and discuss with everyone!</p><a href="https://join.slack.com/t/openimsdk/shared_invite/zt-2hljfom5u-9ZuzP3NfEKW~BJKbpLm0Hw" target="_blank" rel="noopener noreferrer">Join</a></div></div><div class="links"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Product</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://openim.io/commercial" target="_blank" rel="noopener noreferrer" class="footer__link-item">Business</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://openim.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">About Us</a></li><li class="footer__item"><a href="mailto:contact@openim.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact Us</a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/guides/introduction">Documentation</a></li><li class="footer__item"><a href="https://join.slack.com/t/openimsdk/shared_invite/zt-2hljfom5u-9ZuzP3NfEKW~BJKbpLm0Hw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community</a></li></ul></div></div></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © OpenIM since 2023. All rights reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1c292290.js"></script>
<script src="/assets/js/main.f41c926d.js"></script>
</body>
</html>