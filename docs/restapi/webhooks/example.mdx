---
sidebar_position: 2
title: å›è°ƒä¾‹å­
hide_title: true
---

# ğŸ›  ç”¨ OpenIM å®ç°èŠå¤©æœºå™¨äººé—®ç­”åŠŸèƒ½

### **ç®€è¦æè¿°**

ä½¿ç”¨ OpenIM ä¸­çš„ callback æœºåˆ¶å®ç°èŠå¤©æœºå™¨äººé—®ç­”åŠŸèƒ½ã€‚ç»™èŠå¤©æœºå™¨äººå‘é€ä¸€æ¡æ¶ˆæ¯åï¼ˆæ”¯æŒå‘é€æ–‡æœ¬æ¶ˆæ¯å’Œå›¾ç‰‡æ¶ˆæ¯ï¼‰ï¼ŒèŠå¤©æœºå™¨äººæŠŠè¿™æ¡æ¶ˆæ¯è¿”å›ã€‚


## 1.ä¿®æ”¹é…ç½®æ–‡ä»¶
å‚ç…§å¦‚ä¸‹æ¨¡æ¿ä¿®æ”¹ open-im-server ä¸­çš„ config/config.yaml é…ç½®

![PC Web Interface](./assets/config.png)

tips
> url ä¸º å›è°ƒ url

> afterSendSingleMsg.enable ä¸º true æ—¶ï¼Œå¼€å¯è¯¥å›è°ƒ
 
## 2.åˆ›å»ºèŠå¤©æœºå™¨äººè´¦å·å¹¶æŒ‡å®šå…¶ä¸ºé»˜è®¤å¥½å‹
1. ç™»å½•ç®¡ç†åå°ï¼Œåœ¨ç®¡ç†åå°ä¸šåŠ¡ç³»ç»Ÿçš„ç”¨æˆ·ç®¡ç†ä¸­ï¼Œåˆ›å»ºèŠå¤©æœºå™¨äººè´¦å·ï¼Œè®°å½•è¯¥è´¦å·çš„ **userID**

2. åœ¨ç®¡ç†åå°ä¸šåŠ¡ç³»ç»Ÿçš„æ³¨å†Œç®¡ç†ä¸­ï¼Œå°†åˆ›å»ºçš„èŠå¤©æœºå™¨äººè´¦å·æ·»åŠ ä¸ºé»˜è®¤å¥½å‹

Tipsï¼š
> ç™»å½•ç®¡ç†åå°çš„è´¦å·å¯†ç : 

> è´¦å·ï¼šchatAdmin 

> å¯†ç ï¼šchatAdmin

## 3.ç¼–å†™ **afterSendSingleMsg** æ¥å£
å‚è€ƒä¾‹å­å¦‚ä¸‹

tips:
>1ã€éœ€è¦å°†ä¾‹å­ä¸­çš„ **robotics** æ›¿æ¢æˆ **2** ä¸­è·å–çš„ **userID**


```Go
func (m *ChatApi) CallbackExample(c *gin.Context) {
	// 1. Handling callbacks after sending a single chat message
	msgInfo, err := handlingCallbackAfterSendMsg(c)
	if err != nil {
		apiresp.GinError(c, err)
		return
	}

	// 2. If the user receiving the message is a customer service bot, return the message.
	// 2.1 UserID of the robot account
	robotics := "robotics"

	// 2.2 ChatRobot account validation and determining if messages are text and images
	if msgInfo.SendID == robotics || msgInfo.RecvID != robotics {
		return
	}
	if msgInfo.ContentType != constant.Picture && msgInfo.ContentType != constant.Text {
		return
	}

	// 2.3 Get administrator token
	adminToken, err := getAdminToken(c)
	if err != nil {
		apiresp.GinError(c, err)
		return
	}

	// 2.4 Get RobotAccount info
	robUser, err := getRobotAccountInfo(c, adminToken.AdminToken, robotics)
	if err != nil {
		apiresp.GinError(c, err)
		return
	}

	// 2.5 Constructing Message Field Contents
	mapStruct, err := contextToMap(c, msgInfo)
	if err != nil {
		apiresp.GinError(c, err)
		return
	}

	// 2.6 Send Message
	err = sendMessage(c, adminToken.ImToken, robotics, msgInfo, robUser, mapStruct)
	if err != nil {
		apiresp.GinError(c, err)
		return
	}
}

```
è¯¦ç»†ä»£ç å‚è€ƒ
[é“¾æ¥](https://github.com/openimsdk/chat/blob/logs/example/callback/callback.go)

## 4.ä½“éªŒè¯¥åŠŸèƒ½
1ã€å®ç°æ•ˆæœå¦‚ä¸‹

![PC Web Interface](./assets/result.png)

